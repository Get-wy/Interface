(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41dd038e"],{1633:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"BonusSubspecialty-container"},[s("el-page-header",{staticStyle:{"margin-left":"30px","margin-bottom":"30px"},attrs:{title:"返回"},on:{back:t.goBack}}),t._v(" "),s("el-form",{ref:"form",staticClass:"form",attrs:{model:t.form,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"阶段状态"}},[s("tag",{attrs:{type:"tag",text:t.form.subspecialty_status}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"项目编号"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.project_id,callback:function(e){t.$set(t.form,"project_id",e)},expression:"form.project_id"}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"项目名称"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.project_name,callback:function(e){t.$set(t.form,"project_name",e)},expression:"form.project_name"}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"项目类别"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_type,callback:function(e){t.$set(t.form,"project_type",e)},expression:"form.project_type"}},t._l(t.projectTypeList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"设计负责人"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.design_director,callback:function(e){t.$set(t.form,"design_director",e)},expression:"form.design_director"}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"设计阶段"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_phase,callback:function(e){t.$set(t.form,"project_phase",e)},expression:"form.project_phase"}},t._l(t.projectPhaseList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"当前季度"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.season_name,callback:function(e){t.$set(t.form,"season_name",e)},expression:"form.season_name"}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"当前所"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.specialty,callback:function(e){t.$set(t.form,"specialty",e)},expression:"form.specialty"}},t._l(t.specialtyList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"当前专业"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.subspecialty,callback:function(e){t.$set(t.form,"subspecialty",e)},expression:"form.subspecialty"}})],1),t._v(" "),s("el-form-item",{staticClass:"short",attrs:{label:"专业季度产值"}},[s("el-input",{attrs:{disabled:""},model:{value:t.form.subspecialty_sum_bonus,callback:function(e){t.$set(t.form,"subspecialty_sum_bonus",e)},expression:"form.subspecialty_sum_bonus"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"产值分配"}},[s("el-table",{staticStyle:{width:"60%"},attrs:{"summary-method":t.getSummaries,data:t.tableData,"show-summary":"",border:""}},[s("el-table-column",{attrs:{label:"序号",prop:"index",type:"index",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"设计人员",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-select",{attrs:{disabled:""},model:{value:e.row.staffName,callback:function(s){t.$set(e.row,"staffName",s)},expression:"scope.row.staffName"}},t._l(t.selectList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"季度产值比例",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input",{staticClass:"Input",attrs:{disabled:""},on:{blur:function(s){return t.calcuBonus(e.$index,e.row)}},model:{value:e.row.bonusInput,callback:function(s){t.$set(e.row,"bonusInput",s)},expression:"scope.row.bonusInput"}},[s("i",{staticClass:"icon iconfont icon-baifenbi",staticStyle:{"line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"})])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"bonusStaffSeason",label:"季度产值",align:"center"}})],1)],1)],1)],1)},r=[],n=(s("7f7f"),s("96cf"),s("3b8d")),o=(s("c5f6"),s("ac6a"),s("3022")),i=s("ed08"),l=s("c28c"),u={data:function(){var t=function(t,e,s){""===e.progressInput?s(new Error("请输入进度!")):!Object(o["isNumber"])(e.progressInput)||e.progressInput<0?s(new Error("本季度进度格式错误!")):e.progressInput>progressSpecialtyReserved&&s(new Error("本季度进度已超过剩余进度!"))};return{checked:!1,projectTypeList:[],projectPhaseList:[],specialtyList:[],statusList:[],selectList:[],form:{},tableData:[],rules:{progressInput:[{validator:t,trigger:"blur"}]}}},computed:{},components:{Tag:l["a"]},methods:{goBack:function(){console.log(this.form),this.$router.push({path:"/ProductionValueList/BonusSubspecialtyList/".concat(this.form.project_id,"/").concat(1==this.form.specialty?"环境":2==this.form.specialty?"结构":"电仪","/").concat(this.$route.params.seasonName,"/").concat(this.$route.params.type)})},getSummaries:function(t){var e=t.columns,s=t.data,a=[];return e.forEach((function(t,e){if(e<2)a[e]=0===e?"合计":"";else{var r=s.map((function(e){return Number(e[t.property])}));r.every((function(t){return isNaN(t)}))?a[e]="":(a[e]=r.reduce((function(t,e){var s=Number(e);return isNaN(s)?t:t+e}),0),e<4&&(a[e]=a[e].toFixed(2)))}})),a},getUserBonusArray:function(){this.usersBonusArray=this.tableData.map((function(t){return{userId:t.staff,staffBonusRatio:t.bonusInput/100,staffBonus:t.bonusStaffSeason}}))},onSubmit:function(){var t=this;this.getUserBonusArray(),this.$store.dispatch("productionSubspecialtyPrincipal/addbonus",{projectId:this.form.project_id,subspecialty:this.form.subspecialty,sumBonus:this.form.subspecialty_sum_bonus,usersBonusArray:this.usersBonusArray,subspecialtyStatus:!0}).then((function(e){t.$message({message:"产值新增成功!",type:"success"}),t.goBack()}),(function(e){t.$message({message:e,type:"warning"})}))},onUpdateBonusStaffSeason:function(t,e,s){this.tableData[t].bonusStaffSeason=(Number(e.bonusProgressInput)/100*Number(s.bonus_Subspecialty_Season)).toFixed(2)},getUserList:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e={userCard:3,page:"no"},this.$store.dispatch("user/userList",e).then((function(t){var e=[];for(var a in t.data)isNaN(t.data[a].subspecialty)&&t.data[a].subspecialty.lastIndexOf("环卫")>-1&&e.push({value:t.data[a].user_id,label:t.data[a].user_name});s.selectList=e})).catch((function(){}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),calcuBonus:function(t,e){Number(e.bonusInput)>100?this.tableData[t].bonusInput=100:this.tableData[t].bonusStaffSeason=(Number(e.bonusInput/100)*Number(this.form.subspecialty_sum_bonus)).toFixed(2)},getList:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,s){e.$store.dispatch("productionSubspecialtyPrincipal/getinfo",{projectId:e.$route.params.id,subspecialty:e.$route.params.name,seasonName:e.$route.params.seasonName}).then((function(s){console.log(s),e.form=s,e.form.subspecialty_status=Object(i["a"])(e.form.subspecialty_status,e.statusList),e.tableData=s.usersBonusArray,t()})).catch((function(t){e.$message({message:err,type:"error"})}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),init:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("settings/getSettings").then((function(t){e.projectTypeList=t.projectCategory,e.projectPhaseList=t.designPhase,e.specialtyList=t.placeList,e.statusList=t.stageStatusDesignprinciple}));case 2:return t.next=4,this.getUserList();case 4:return t.next=6,this.getList();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.init()}},c=u,p=(s("aaa4"),s("2877")),f=Object(p["a"])(c,a,r,!1,null,null,null);e["default"]=f.exports},2274:function(t,e,s){},aaa4:function(t,e,s){"use strict";var a=s("2274"),r=s.n(a);r.a}}]);