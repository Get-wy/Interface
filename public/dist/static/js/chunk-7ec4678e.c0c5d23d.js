(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ec4678e"],{"04c0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"BonusDistribute-container"},[a("el-page-header",{staticStyle:{"margin-left":"30px","margin-bottom":"30px"},attrs:{title:"返回"},on:{back:t.goBack}}),t._v(" "),a("el-form",{ref:"form",staticClass:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"阶段状态"}},[a("tag",{attrs:{type:"tag",text:t.form.subspecialty_status}},[t._v("\n          "+t._s(t.form.subspecialty_status)+"\n      ")])],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"项目编号"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.project_id,callback:function(e){t.$set(t.form,"project_id",e)},expression:"form.project_id"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"项目名称"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.project_name,callback:function(e){t.$set(t.form,"project_name",e)},expression:"form.project_name"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"项目类别"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_type,callback:function(e){t.$set(t.form,"project_type",e)},expression:"form.project_type"}},t._l(t.projectTypeList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"设计负责人"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.design_director,callback:function(e){t.$set(t.form,"design_director",e)},expression:"form.design_director"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"设计阶段"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_phase,callback:function(e){t.$set(t.form,"project_phase",e)},expression:"form.project_phase"}},t._l(t.projectPhaseList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"当前季度"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.season_name,callback:function(e){t.$set(t.form,"season_name",e)},expression:"form.season_name"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"当前所"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.specialty,callback:function(e){t.$set(t.form,"specialty",e)},expression:"form.specialty"}},t._l(t.specialtyList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"当前专业"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.subspecialty,callback:function(e){t.$set(t.form,"subspecialty",e)},expression:"form.subspecialty"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"专业季度产值"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.subspecialty_sum_bonus,callback:function(e){t.$set(t.form,"subspecialty_sum_bonus",e)},expression:"form.subspecialty_sum_bonus"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"产值分配"}},[a("el-button",{attrs:{disabled:"未录入"!==t.form.subspecialty_status&&"已录入"!==t.form.subspecialty_status,size:"small",type:"success",plain:""},on:{click:function(e){return t.handleAdd()}}},[t._v("\n        新增\n      ")]),t._v(" "),a("el-table",{staticStyle:{width:"750px"},attrs:{"summary-method":t.getSummaries,data:t.tableData,"show-summary":"",border:""}},[a("el-table-column",{attrs:{label:"序号",prop:"index",type:"index",align:"center",width:"80px"}}),t._v(" "),a("el-table-column",{attrs:{prop:"staff",label:"设计人员",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择设计人员"},model:{value:e.row.staff,callback:function(a){t.$set(e.row,"staff",a)},expression:"scope.row.staff"}},t._l(t.selectList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:t.disabled}})})),1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"ratio",label:"季度产值比例",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"Input",on:{input:function(e){return t.change(e)},blur:function(a){return t.calcuBonus(e.$index,e.row)}},model:{value:e.row.bonusInput,callback:function(a){t.$set(e.row,"bonusInput",a)},expression:"scope.row.bonusInput"}},[a("i",{staticClass:"icon iconfont icon-baifenbi",staticStyle:{"line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"bonusStaffSeason",label:"季度产值",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",size:"small",plain:"",disabled:"未录入"!==t.form.subspecialty_status&&"已录入"!==t.form.subspecialty_status},on:{click:function(a){return t.handleDel(e.$index,t.tableData)}}},[t._v("\n              删除\n            ")])]}}])})],1),t._v(" "),a("el-link",{directives:[{name:"show",rawName:"v-show",value:!t.isInputLegal,expression:"!isInputLegal"}],attrs:{underline:!1,type:"warning"}},[t._v("未选择设计人员")]),t._v(" "),a("el-link",{directives:[{name:"show",rawName:"v-show",value:t.sumRatio<100,expression:"sumRatio < 100"}],attrs:{underline:!1,type:"warning"}},[t._v("产值比例未完全分配")]),t._v(" "),a("el-link",{directives:[{name:"show",rawName:"v-show",value:t.sumRatio>100,expression:"sumRatio > 100"}],attrs:{underline:!1,type:"warning"}},[t._v("产值比例分配超标")])],1),t._v(" "),a("el-form-item",[[a("el-checkbox",{model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},[t._v("完成并提交")])]],2),t._v(" "),a("el-form-item",[a("el-button",{attrs:{disabled:100!=t.sumRatio||"未录入"!==t.form.subspecialty_status&&"已录入"!==t.form.subspecialty_status,type:"primary"},on:{click:function(e){return t.onSubmit()}}},[t._v("\n        确定\n      ")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.output()}}},[t._v("\n        导出\n      ")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.print()}}},[t._v("\n        打印\n      ")])],1)],1)],1)},n=[],r=(a("96cf"),a("3b8d")),i=(a("ac6a"),a("75fc")),o=(a("c5f6"),a("db72")),l=a("ed08"),u=a("c28c"),c=a("a78e"),p=a.n(c),f=a("add5"),b=a.n(f),m={name:"Bonusdistribute",data:function(){return{tempTableData:[],checked:!1,form:{},tableData:[],projectTypeList:[],projectPhaseList:[],specialtyList:[],statusList:[],usersBonusArray:[],selectList:[],sumRatio:0,isInputLegal:!0,user:JSON.parse(p.a.get("userInfo")),sum2:0,sum3:0}},computed:{},components:{Tag:u["a"]},methods:{output:function(){var t=this;for(var e in this.tempTableData.length=0,this.sum2=0,this.sum3=0,this.tableData)this.tempTableData[e]=Object(o["a"])({},{index:Number(e)+1},{},this.tableData[e]),this.sum2+=Number(this.tempTableData[e].ratio),this.sum3+=Number(this.tempTableData[e].bonusStaffSeason),this.tempTableData[e].staff&&(this.tempTableData[e].staff=Object(l["a"])(this.tempTableData[e].staff,this.selectList));this.tempTableData=[].concat(Object(i["a"])(this.tempTableData),[{index:"合计",staff:"",ratio:Number(this.sum2).toFixed(2),bonusStaffSeason:Number(this.sum3).toFixed(2)}]),this.downloadLoading=!0,Promise.all([a.e("chunk-e69e90f4"),a.e("chunk-2181d362")]).then(a.bind(null,"4bf8d")).then((function(e){var a=["序号","设计人员","季度产值比例","季度产值"],s=["index","staff","ratio","bonusStaffSeason"],n=t.tempTableData,r=t.formatJson(s,n);e.export_json_to_excel({header:a,data:r,filename:"个人产值明细",autoWidth:!0,bookType:"xlsx"}),t.downloadLoading=!1}))},print:function(){for(var t in this.tempTableData.length=0,this.sum2=0,this.sum3=0,this.tableData)this.tempTableData[t]=Object(o["a"])({},{index:Number(t)+1},{},this.tableData[t]),this.sum2+=Number(this.tempTableData[t].ratio),this.sum3+=Number(this.tempTableData[t].bonusStaffSeason),this.tempTableData[t].staff&&(this.tempTableData[t].staff=Object(l["a"])(this.tempTableData[t].staff,this.selectList));this.tempTableData=[].concat(Object(i["a"])(this.tempTableData),[{index:"合计",staff:"",ratio:Number(this.sum2).toFixed(2),bonusStaffSeason:Number(this.sum3).toFixed(2)}]);var e={printable:this.tempTableData,properties:[{field:"index",displayName:"序号"},{field:"staff",displayName:"设计人员"},{field:"ratio",displayName:"产值比例(%)"},{field:"bonusStaffSeason",displayName:"产值"}],type:"json",gridHeaderStyle:"color: black;  border: 1px solid #000000;",gridStyle:"border: 1px solid #000000;"};b()(e)},formatJson:function(t,e){return e.map((function(e){return t.map((function(t){return e[t]}))}))},change:function(t){this.$forceUpdate()},goBack:function(){this.$router.push({path:"/bonus-subspecialtyprincipal/BonusManage"})},getSummaries:function(t){var e=this,a=t.columns,s=t.data,n=[];return a.forEach((function(t,a){if(a<2)n[a]=0===a?"合计":"";else{var r=s.map((function(e){return Number(e[t.property])}));r.every((function(t){return isNaN(t)}))?n[a]="":(n[a]=r.reduce((function(t,e){var a=Number(e);return isNaN(a)?t:t+e}),0),3===a&&(n[a]=n[a].toFixed(2))),2==a&&(e.sumRatio=n[a],n[a]+="%")}})),n},validate:function(){for(var t in this.isInputLegal=!0,this.tableData)if(void 0==this.tableData[t].staff||""===this.tableData[t].staff)return void(this.isInputLegal=!1)},handleAdd:function(){this.tableData=[{staff:"",bonusInput:"",bonusStaffSeason:""}].concat(Object(i["a"])(this.tableData)),this.tableData.reverse().reverse(),this.validate()},handleDel:function(t,e){this.changeTableUserListEnabledStatus(),e.splice(t,1),this.tableData.reverse().reverse(),this.validate()},calcuBonus:function(t,e){isNaN(e.bonusInput)?e.bonusInput=0:Number(e.bonusInput)>100?this.tableData[t].bonusInput=100:(e.bonusInput=parseInt(e.bonusInput),this.tableData[t].bonusStaffSeason=(Number(e.bonusInput/100)*Number(this.form.subspecialty_sum_bonus)).toFixed(2)),e.ratio=this.tableData[t].bonusInput,this.validate()},readsettings:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){e.$store.dispatch("settings/getSettings").then((function(a){e.projectTypeList=a.projectCategory,e.projectPhaseList=a.designPhase,e.specialtyList=a.placeList,e.statusList=a.stageStatusDesignprinciple,t()}),(function(t){a(t)}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),changeTableUserListEnabledStatus:function(){var t=[];for(var e in this.tableData)t.push(this.tableData[e].staff);for(var a in this.selectList)t.lastIndexOf(this.selectList[a].value)>-1?this.selectList[a].disabled=!0:this.selectList[a].disabled=!1;this.validate()},getBonusInfo:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){e.$store.dispatch("productionSubspecialtyPrincipal/getinfo",{projectId:e.$route.params.projectId,subspecialty:e.$route.params.subspecialty}).then((function(a){for(var s in e.form=a,e.form.subspecialty_status=Object(l["a"])(e.form.subspecialty_status,e.statusList),e.tableData=a.usersBonusArray,e.tableData)e.tableData[s].ratio=e.tableData[s].bonusInput;e.validate(),t()})).catch((function(t){e.$message({message:t,type:"error"})}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),init:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.readsettings();case 2:return t.next=4,this.getUserList();case 4:return t.next=6,this.getBonusInfo();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getUserList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){var s={userCard:3,page:"no"};e.$store.dispatch("user/userList",s).then((function(a){var s=[];for(var n in a.data)a.data[n].specialty===e.user.specialty&&a.data[n].subspecialty.lastIndexOf(e.$route.params.subspecialty)>-1&&s.push({value:a.data[n].user_id,label:a.data[n].user_name});e.selectList=s,console.log("人员",e.selectList),t()})).catch((function(t){e.$message({message:t,type:"error"})}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),getUserBonusArray:function(){this.usersBonusArray=this.tableData.map((function(t){return{userId:t.staff,staffBonusRatio:Number(t.bonusInput)/100,staffBonus:t.bonusStaffSeason}}))},onSubmit:function(){var t=this;this.getUserBonusArray(),this.$store.dispatch("productionSubspecialtyPrincipal/addbonus",{projectId:this.form.project_id,subspecialty:this.form.subspecialty,sumBonus:this.form.subspecialty_sum_bonus,usersBonusArray:this.usersBonusArray,checked:this.checked}).then((function(e){t.$message({message:"产值分配提交成功!",type:"success"}),t.$router.push({path:"/bonus-subspecialtyprincipal/BonusManage"})})).catch((function(e){t.$message({message:e,type:"error"})}))}},mounted:function(){this.init()}},d=m,h=d,v=(a("402d"),a("2877")),y=Object(v["a"])(h,s,n,!1,null,"4c25d2be",null);e["default"]=y.exports},"3b98":function(t,e,a){},"402d":function(t,e,a){"use strict";var s=a("3b98"),n=a.n(s);n.a},c28c:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tag"},["tag"===t.type?a("el-tag",{attrs:{type:t.selectColor}},[t._v(t._s(t.text))]):t._e(),t._v(" "),"button"===t.type?a("el-button",{attrs:{type:t.selectColor,plain:"",size:"small",disabled:t.open}},[t._v(t._s(t.text))]):t._e()],1)},n=[],r={name:"tag",props:{type:{type:String,default:function(){return"请输入类型"}},text:{type:String,default:function(){return"请输入文字"}},open:{type:Boolean,default:function(){return!1}}},computed:{selectColor:function(){switch(this.text){case"未录入":return"danger";case"已录入":return"warning";case"已提交":return"success";case"已修改":return"primary";case"已发放":return"info";default:return"info"}}},data:function(){return{}},mounted:function(){}},i=r,o=a("2877"),l=Object(o["a"])(i,s,n,!1,null,null,null);e["a"]=l.exports},ed08:function(t,e,a){"use strict";a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return n}));a("28a5"),a("a481"),a("6b54"),a("7618");function s(t,e){for(var a in e)if(e[a].value==t)return e[a].label}function n(t,e){for(var a in e)if(e[a].label==t)return e[a].value}}}]);