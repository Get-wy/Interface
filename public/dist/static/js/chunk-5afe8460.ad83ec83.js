(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5afe8460"],{"386d":function(t,e,a){"use strict";var s=a("bc81"),i=a.n(s);i.a},"3fe2":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"BonusSubspecialtyList-container"},[a("el-page-header",{staticStyle:{"margin-left":"30px","margin-bottom":"30px"},attrs:{title:"返回"},on:{back:t.goBack}}),t._v(" "),a("el-form",{ref:"form",staticClass:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{staticClass:"short",attrs:{label:"项目编号"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.project_Number,callback:function(e){t.$set(t.form,"project_Number",e)},expression:"form.project_Number"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"项目名称"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.project_Name,callback:function(e){t.$set(t.form,"project_Name",e)},expression:"form.project_Name"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"项目类别"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_type,callback:function(e){t.$set(t.form,"project_type",e)},expression:"form.project_type"}},t._l(t.projectTypeList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"设计阶段"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.project_phase,callback:function(e){t.$set(t.form,"project_phase",e)},expression:"form.project_phase"}},t._l(t.projectPhaseList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"当前季度"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.current_Season,callback:function(e){t.$set(t.form,"current_Season",e)},expression:"form.current_Season"}})],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"当前所"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""},model:{value:t.form.specialty,callback:function(e){t.$set(t.form,"specialty",e)},expression:"form.specialty"}},t._l(t.specialtyList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{staticClass:"short",attrs:{label:"所季度产值"}},[a("el-input",{attrs:{disabled:""},model:{value:t.form.season_bonus,callback:function(e){t.$set(t.form,"season_bonus",e)},expression:"form.season_bonus"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"产值分配"}},[a("el-table",{staticClass:"table",staticStyle:{"margin-top":"15px",width:"80%"},attrs:{"summary-method":t.getSummaries,"show-summary":"",data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"subspecialty",label:"专业",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"专业负责人",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{disabled:t.checkSubspecialtyBonusRatio(e.row.subspecialtyBonusRatio),filterable:"",clearable:""},model:{value:e.row.subspecialtyPrincipal,callback:function(a){t.$set(e.row,"subspecialtyPrincipal",a)},expression:"scope.row.subspecialtyPrincipal"}},t._l(t.userList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"subspecialtyBonusRatio",label:"产值比例",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"Input",on:{change:function(a){return t.calcuBonus(e.$index,e.row)}},model:{value:e.row.subspecialtyBonusRatio,callback:function(a){t.$set(e.row,"subspecialtyBonusRatio",a)},expression:"scope.row.subspecialtyBonusRatio"}},[a("i",{staticClass:"icon iconfont icon-baifenbi",staticStyle:{"line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"subspecialtyBonus",label:"专业季度产值",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"阶段状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("tag",{attrs:{type:"button",text:e.row.button,open:t.openButton(e.row.button)},nativeOn:{click:function(a){return t.handleClickStatus(e.row)}}})]}}])})],1),t._v(" "),a("el-link",{directives:[{name:"show",rawName:"v-show",value:t.sumRatio>100,expression:"sumRatio > 100"}],attrs:{underline:!1,type:"warning"}},[t._v("专业产值比例之和超标")])],1),t._v(" "),a("el-form-item",{staticStyle:{"margin-top":"'22px'"}},[a("el-button",{attrs:{type:"primary",disabled:1===t.user.institute||100!==t.sumRatio},on:{click:t.onSubmit}},[t._v("\n        确认\n      ")]),t._v(" "),a("el-button",{on:{click:t.goBack}},[t._v("取消")])],1)],1)],1)},i=[],r=(a("96cf"),a("3b8d")),n=(a("c5f6"),a("ac6a"),a("3022"),a("ed08")),o=a("a78e"),l=a.n(o),c=(a("c695"),a("c28c")),u={name:"BonusSubspecialtyList",data:function(){return{sumRatio:0,result:!0,user:JSON.parse(l.a.get("userInfo")),projectTypeList:[],projectPhaseList:[],specialtyList:[],stageStatusDesignprinciple:[],form:{},userList:[],tableData:[],loading:!1}},components:{Tag:c["a"]},computed:{},methods:{getSummaries:function(t){var e=this,a=t.columns,s=t.data,i=[];return a.forEach((function(t,a){if(a<2)i[a]=0===a?"合计":"";else{var r=s.map((function(e){return Number(e[t.property])}));r.every((function(t){return isNaN(t)}))?i[a]="":(i[a]=r.reduce((function(t,e){var a=Number(e);return isNaN(a)?t:t+e}),0),2!==a&&4!==a||(i[a]=i[a].toFixed(2))),3===a&&(i[a]=Math.round(100*i[a])/100),2==a&&(e.sumRatio=Number(i[a]),i[a]+="%")}})),i},onSubmitStatues:function(){for(var t in this.result=!0,this.tableData){if("已发放"===this.tableData[t].button)return;if("未录入"!==this.tableData[t].button&&"已录入"!==this.tableData[t].button)return void(this.result=!1)}},openButton:function(t){if("未录入"===t||"已录入"===t)return!0},goBack:function(){this.$router.push({path:"/bonus-principal-project/ProjectList"})},handleClickStatus:function(t){"未录入"==t.button||"已录入"==t.button?console.log():this.$router.push({path:"/bonus-principal-project/BonusSubspecialty/".concat(this.form.project_Number,"/").concat(t.subspecialty)})},getList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){e.$store.dispatch("bonusPrincipal/getBonusSubspecialtyList",{id:e.$route.params.id}).then((function(a){e.form=a,e.tableData=a.data,console.log(e.form,e.tableData),e.form.project_type=Object(n["a"])(e.form.project_Category,e.projectTypeList),e.form.project_phase=Object(n["a"])(e.form.design_Stage,e.projectPhaseList),e.form.specialty=Object(n["a"])(e.form.current_Specialty,e.specialtyList);for(var s=0;s<e.tableData.length;s++)e.tableData[s].button=Object(n["a"])(e.tableData[s].button,e.stageStatusDesignprinciple),e.tableData[s].subspecialtyBonusRatio=e.tableData[s].subspecialtyBonusRatio,e.tableData[s].subspecialtyBonusRatio;console.log("this.tadawdaw",e.tableData),t()})).catch((function(t){e.$message({message:t,type:"error"})}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),getUserList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={page:"no",userCard:2},t.abrupt("return",new Promise((function(t,e){s.$store.dispatch("user/userList",a).then((function(e){for(var a in console.log("form",e.data),e.data)JSON.parse(l.a.get("userInfo")).specialty===e.data[a].specialty&&1===e.data[a].specialty_principal&&s.userList.push({label:e.data[a].user_name,value:e.data[a].user_id});console.log("form.specialty",s.userList),t()})).catch((function(){}))})));case 2:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),checkSubspecialtyBonusRatio:function(t){return!(t>0)},calcuBonus:function(t,e){console.log(t,e,this.tableData),e.subspecialtyBonusRatio<=0&&(this.tableData[t].subspecialtyPrincipal=""),(isNaN(e.subspecialtyBonusRatio)||e.subspecialtyBonusRatio<0||e.subspecialtyBonusRatio>100)&&(e.subspecialtyBonusRatio=0),e.subspecialtyBonus=(this.form.season_bonus*e.subspecialtyBonusRatio/100).toFixed(2)},onSubmit:function(){var t=this;for(var e in this.tableData)if(this.tableData[e].subspecialtyBonusRatio>0&&!this.tableData[e].subspecialtyPrincipal)return void this.$message({message:"请为".concat(this.tableData[e].subspecialty,"专业选择专业负责人"),type:"error"});this.loading=!0;var a={projectId:this.form.project_Number,subspecialtyArray:this.tableData};this.$store.dispatch("bonusPrincipal/updateBonusSubspecialtyList",a).then((function(e){t.loading=!1,t.$message({message:"产值比例修改成功",type:"success"})})).catch((function(e){t.loading=!1,t.$message({message:e,type:"error"})}))},init:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("settings/getSettings").then((function(t){e.projectTypeList=t.projectCategory,e.projectPhaseList=t.designPhase,e.specialtyList=t.placeList,e.stageStatusDesignprinciple=t.stageStatusDesignprinciple})).catch((function(){}));case 2:return t.next=4,this.getUserList();case 4:return t.next=6,this.getList();case 6:this.onSubmitStatues();case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.init()}},p=u,b=p,f=(a("386d"),a("2877")),m=Object(f["a"])(b,s,i,!1,null,"90721afe",null);e["default"]=m.exports},bc81:function(t,e,a){}}]);