(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38cfe2ce"],{"21eb":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ProgressSubmit-container"},[r("el-page-header",{staticStyle:{"margin-left":"30px","margin-bottom":"30px"},attrs:{title:"返回"},on:{back:e.goBack}}),e._v(" "),r("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"阶段状态"}},[r("tag",{staticStyle:{display:"inline-block"},attrs:{type:"tag",text:e.form.stage_Status}})],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"项目编号"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.project_Number,callback:function(t){e.$set(e.form,"project_Number",t)},expression:"form.project_Number"}})],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"项目名称"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.project_Name,callback:function(t){e.$set(e.form,"project_Name",t)},expression:"form.project_Name"}})],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"项目类别"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择"},model:{value:e.form.project_Category,callback:function(t){e.$set(e.form,"project_Category",t)},expression:"form.project_Category"}},e._l(e.project_CategoryList,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"设计阶段"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:"请选择"},model:{value:e.form.design_Stage,callback:function(t){e.$set(e.form,"design_Stage",t)},expression:"form.design_Stage"}},e._l(e.design_StageList,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"当前季度"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.current_Season,callback:function(t){e.$set(e.form,"current_Season",t)},expression:"form.current_Season"}})],1),e._v(" "),r("el-form-item",{staticClass:"short",attrs:{label:"设计负责人"}},[r("el-input",{attrs:{disabled:""},model:{value:e.form.design_Principle,callback:function(t){e.$set(e.form,"design_Principle",t)},expression:"form.design_Principle"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"90%","margin-top":"15px"},attrs:{label:"进度调整"}},[r("el-table",{attrs:{data:e.tableData,"summary-method":e.getSummaries,"show-summary":"",border:""}},[r("el-table-column",{attrs:{prop:"specialty",label:"所",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"bonusSpecialty",label:"所计算产值",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"progressSpecialtyLimit",label:"所进度上限",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"progressSpecialtyDistributed",label:"已发放进度",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"bonusSpecialtyDistributed",label:"已发放产值",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"progressSpecialtyReserved",label:"剩余进度",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"bonusSpecialtyReserved",label:"剩余产值",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"本季度进度",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{staticClass:"Input",on:{input:function(t){return e.change(t)},blur:function(r){return e.onUpdateBonusInput(t.$index,t.row)}},model:{value:t.row.progressInput,callback:function(r){e.$set(t.row,"progressInput",r)},expression:"scope.row.progressInput"}},[r("i",{staticClass:"icon iconfont icon-baifenbi",staticStyle:{"line-height":"40px"},attrs:{slot:"suffix"},slot:"suffix"})])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"本季度产值",prop:"bonusInput",align:"center"}})],1)],1),e._v(" "),r("el-form-item",[[r("el-checkbox",{attrs:{disabled:"未录入"!==e.form.stage_Status&&"已录入"!==e.form.stage_Status,label:"完成并提交"},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})]],2),e._v(" "),r("el-form-item",[r("el-button",{attrs:{disabled:"未录入"!==e.form.stage_Status&&"已录入"!==e.form.stage_Status,type:"primary"},on:{click:e.onSubmit}},[e._v("\n        确定\n      ")])],1)],1)],1)},s=[],n=(r("96cf"),r("3b8d")),o=(r("a481"),r("c5f6"),r("ac6a"),r("ed08")),i=(r("3022"),r("c28c")),l=(r("b383"),{name:"ProgressSubmit",data:function(){return{checked:!1,project_CategoryList:[],design_StageList:[],statusList:[],specialtyList:[],form:{},tableData:[],sumRow:[]}},computed:{},components:{Tag:i["a"]},methods:{change:function(e){this.$forceUpdate()},goBack:function(){this.$router.push({path:"/bonus-designprincipal/ProgressManage"})},getSummaries:function(e){var t=e.columns,r=e.data,a=[];return t.forEach((function(e,t){if(1==t||4==t||6==t||8==t){var s=r.map((function(t){return Number(t[e.property])}));s.every((function(e){return isNaN(e)}))?a[t]="":(a[t]=s.reduce((function(e,t){var r=Number(t);return isNaN(r)?e:e+t}),0),1!==t&&4!==t&&6!==t&&8!==t||(a[t]=a[t].toFixed(2)))}else a[t]=0===t?"合计":""})),this.sumRow=a,a},onUpdateBonusInput:function(e,t){isNaN(t.progressInput)&&(t.progressInput=0),Number(t.progressInput)>Number(t.progressSpecialtyReserved.replace("%",""))&&(this.tableData[e].progressInput=this.tableData[e].progressSpecialtyReserved.replace("%","")),t.progressInput=parseInt(t.progressInput),this.tableData[e].bonusInput=(Number(t.progressInput)/Number(t.progressSpecialtyLimit.replace("%",""))*Number(t.bonusSpecialty)).toFixed(2)},onSubmit:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.form.validate((function(e){if(!e)return!1;t.$store.dispatch("productionDesignprincipal/addprojectprogress",{tableData:t.tableData,projectId:t.form.project_Number,checked:t.checked,sumrow:t.sumRow}).then((function(){t.$message({message:"项目进度提交成功",type:"success"}),t.$router.push({path:"/bonus-designprincipal/ProgressManage"})})).catch((function(e){t.$message({message:e,type:"error"})}))}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),readSettings:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.$store.dispatch("settings/getSettings").then((function(r){t.project_CategoryList=r.projectCategory,t.design_StageList=r.designPhase,t.statusList=r.stageStatusDesignprinciple,t.specialtyList=r.placeList,e()})).catch((function(e){t.$message({message:e,type:"error"})}))})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),getProgressInfo:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.$store.dispatch("productionDesignprincipal/getProjectProgressInfo",{projectId:t.$route.params.id}).then((function(r){for(var a in t.form=r,t.form.stage_Status=Object(o["a"])(t.form.stage_Status,t.statusList),t.tableData=r.progress_array,t.tableData)t.tableData[a].specialty=Object(o["a"])(t.tableData[a].specialty,t.specialtyList);e()})).catch((function(e){t.$message.error({err:e})}))})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),init:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.readSettings();case 2:return e.next=4,this.getProgressInfo();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.init()}}),c=l,u=c,p=(r("f102"),r("2877")),m=Object(p["a"])(u,a,s,!1,null,"04f6a08d",null);t["default"]=m.exports},"401c":function(e,t,r){},f102:function(e,t,r){"use strict";var a=r("401c"),s=r.n(a);s.a}}]);